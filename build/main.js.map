{"version":3,"sources":["webpack://api-architecture-nodejs/./src/configs/cors.ts","webpack://api-architecture-nodejs/./src/configs/swagger.ts","webpack://api-architecture-nodejs/./src/routes/api.routes.ts","webpack://api-architecture-nodejs/./src/routes/index.ts","webpack://api-architecture-nodejs/./src/routes/public.routes.ts","webpack://api-architecture-nodejs/./src/services/index.ts","webpack://api-architecture-nodejs/./src/services/public.service.ts","webpack://api-architecture-nodejs/./src/services/users.service.ts","webpack://api-architecture-nodejs/./src/shared/auth/auth.ts","webpack://api-architecture-nodejs/./src/shared/helpers/api.response.ts","webpack://api-architecture-nodejs/./src/shared/helpers/util.ts","webpack://api-architecture-nodejs/external \"@prisma/client\"","webpack://api-architecture-nodejs/external \"body-parser\"","webpack://api-architecture-nodejs/external \"cors\"","webpack://api-architecture-nodejs/external \"express\"","webpack://api-architecture-nodejs/external \"morgan\"","webpack://api-architecture-nodejs/external \"swagger-ui-express\"","webpack://api-architecture-nodejs/webpack/bootstrap","webpack://api-architecture-nodejs/webpack/runtime/compat get default export","webpack://api-architecture-nodejs/webpack/runtime/define property getters","webpack://api-architecture-nodejs/webpack/runtime/hasOwnProperty shorthand","webpack://api-architecture-nodejs/webpack/runtime/make namespace object","webpack://api-architecture-nodejs/./src/server.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import { CorsOptions } from 'cors'\nconst corsOptions: CorsOptions = {\n    \n}\nexport default corsOptions","export const swaggerDocument = {\n    openapi: '3.0.1',\n    info: {\n        version: '1.0.0',\n        title: 'Architecture Base API',\n        description: 'Architecture base for nodejs/express/ts api',\n        termsOfService: '',\n        contact: {\n            name: 'Patricio Cordero',\n            email: 'patricio@espejozen.cl',\n            url: 'https://patriciocordero.me'\n        },\n        license: {\n            name: 'Apache 2.0',\n            url: 'https://www.apache.org/licenses/LICENSE-2.0.html'\n        }\n    }\n}","import { Router, Response, Request } from \"express\"\nimport { usersService } from \"../services\"\nimport { Auth } from \"../shared/auth/auth\"\nimport { handleApiResponse } from '../shared/helpers/api.response'\nconst router = Router()\nconst auth = new Auth()\n\nrouter.get(\"/\", (req: Request, res: Response) => {\n  res.redirect(\"/docs\")\n})\n\nlet namespace = '/users'\nrouter.post(`/token`, usersService.token)\nrouter.get(`${namespace}`, auth.handleAuth, usersService.index)\nrouter.get(`${namespace}/:id`, auth.handleAuth, usersService.getById)\nrouter.put(`${namespace}/:id`, auth.handleAuth, usersService.update)\nrouter.delete(`${namespace}/:id`, auth.handleAuth, usersService.remove)\nrouter.post(`${namespace}`, auth.handleAuth, usersService.create)\nrouter.post(`${namespace}/register`, usersService.register)\n\n\nnamespace = '/booking'\n/*router.get(`${namespace}`, auth.handleAuth, usersService.index)\nrouter.get(`${namespace}/:id`, auth.handleAuth, usersService.getById)\nrouter.put(`${namespace}/:id`, auth.handleAuth, usersService.update)\nrouter.delete(`${namespace}/:id`, auth.handleAuth, usersService.delete)\nrouter.post(`${namespace}`, auth.handleAuth, usersService.create)\nrouter.post(`${namespace}/register`, usersService.register)\nrouter.post(`${namespace}/token`, usersService.token)\n*/\n\nrouter.use('*',handleApiResponse)\n\n\nexport default router\n\n","import * as publicRoutes from \"./public.routes\"\nimport * as apiRoutes from './api.routes'\n\nexport const pub = publicRoutes.default\nexport const api = apiRoutes.default","import { Router } from 'express'\nimport { pubService } from \"../services\";\n\nexport const router = Router()\n\nrouter.get('/', pubService.index)\n\n\nexport default router","export * as pubService from './public.service'\nexport * as usersService from './users.service'","import { Request, Response } from 'express'\n\nexport const index = (req:Request, res:Response) : void => {\n    res.status(200).json({message:'public'})\n}\n","import { NextFunction, Request, Response } from 'express'\nimport { PrismaClient } from '@prisma/client'\nimport { toJsonArr } from '../shared/helpers/util'\nconst prisma = new PrismaClient()\n\n\n\nexport const index = async (req:Request, res:Response, next:NextFunction):Promise<void> => {\n    try{\n        const users = await prisma.user.findMany({take:50})\n        res.status(200).json({error:null, data:toJsonArr(users)})\n    }catch(error){\n        next(error)\n    }\n}\n\nexport const getById = (req:Request, res:Response): void => {\n    res.status(200).json({message:'user:getById'})\n}\n\nexport const update = (req:Request, res:Response): void => {\n    res.status(200).json({message:'user:update'})\n}\n\nexport const remove = (req:Request, res:Response): void => {\n    res.status(200).json({message:'user:remove'})\n}\n\nexport const create = (req:Request, res:Response): void => {\n    res.status(200).json({message:'user:create'})\n}\n\nexport const register = (req:Request, res:Response): void => {\n    res.status(200).json({message:'user:register'})\n}\n\nexport const token = (req:Request, res:Response): void => {\n    res.status(200).json({message:'user:token'})\n}\n","import { iAuth } from './iauth'\nimport { Request, Response, NextFunction } from \"express\";\n\nexport class Auth implements iAuth {\n    async handleAuth(level: string, req: Request, res: Response, next: NextFunction): Promise<void> {\n        const { authorization } = req.headers\n        const auth = true\n        console.log(authorization)\n        if (level == 'private' && auth) next()\n        else if (level == 'public') next()\n        else res.status(401).json({ message: 'Unauthorized access' })\n    }\n}","import { NextFunction, Request, Response } from 'express'\n\n\nexport const handleApiResponse = (err:Error, req:Request, res:Response, next:NextFunction) => {\n  //console.log(err)\n  if(err){\n    res.status(500).json({error:err.message, data:null})\n  }\n  \n//  console.log('restssss')\n // console.log('err', err)\n  //console.log('handler',req)\n}\n","export const toJson = (data:any) => {\n    if (data !== undefined) {\n        let intCount = 0, repCount = 0;\n        const json = JSON.stringify(data, (_, v) => {\n            if (typeof v === 'bigint') {\n                intCount++;\n                return `${v}#bigint`;\n            }\n            return v;\n        });\n        const res = json.replace(/\"(-?\\d+)#bigint\"/g, (_, a) => {\n            repCount++;\n            return a;\n        });\n        if (repCount > intCount) {\n            // You have a string somewhere that looks like \"123#bigint\";\n            throw new Error(`BigInt serialization conflict with a string value.`);\n        }\n        return JSON.parse(res);\n    }\n}\nexport const toJsonArr = (data:any[]) => {\n  return data.map(v => toJson(v))\n}\n","module.exports = require(\"@prisma/client\");;","module.exports = require(\"body-parser\");;","module.exports = require(\"cors\");;","module.exports = require(\"express\");;","module.exports = require(\"morgan\");;","module.exports = require(\"swagger-ui-express\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import * as express from 'express'\nimport cors, { CorsOptions } from 'cors'\nimport * as corsOptions from './configs/cors'\nimport { json, urlencoded } from 'body-parser'\nimport * as morgan from \"morgan\";\n\nimport * as SwaggerUi from 'swagger-ui-express'\nimport { swaggerDocument } from './configs/swagger'\n\nimport { pub, api } from './routes/index'\nimport { handleApiResponse } from './shared/helpers/api.response'\n\n\nconst app = express()\n\nconst { NODE_ENV } = process.env\n\n\napp.use(morgan(NODE_ENV == 'development' ? 'dev' : 'tiny'))\napp.use(cors(<CorsOptions>corsOptions))\napp.use(json())\napp.use(urlencoded({ extended: true }))\napp.use('/docs', SwaggerUi.serve, SwaggerUi.setup(swaggerDocument))\n\n\napp.use('/', pub)\napp.use('/api', api)\n\n//app.use('*', handleApiResponse)\n\nconst { PORT = 3000 } = process.env\n\napp.listen(PORT, () => {\n    console.log(`Server started at http://localhost:${PORT}`)\n})\n"],"sourceRoot":""}